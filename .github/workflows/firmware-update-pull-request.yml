# This file was auto-generated by the Firebase CLI
# https://github.com/firebase/firebase-tools

name: Compile and update firmware on pr
'on': pull_request
jobs:
  build_and_preview:
    if: '${{ github.event.pull_request.head.repo.full_name == github.repository }}'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Install PIO cli
        run: python3 -c "$(curl -fsSL https://raw.githubusercontent.com/platformio/platformio/master/scripts/get-platformio.py)"
      - name: Add pio to PATH
        run: ln -s ~/.platformio/penv/bin/pio /usr/local/bin/pio
      - name: Install firebase-admin
        run: |
          pip install protobuf --upgrade
          sudo apt install python3-testresources
          pip install firebase-admin --upgrade
      - name: Compile and upload binary
        run: python3 ./.github/scripts/ota_update.py
        env:
          FB_ADMIN: ${{ secrets.FB_ADMIN }}
